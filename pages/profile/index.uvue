<template>
	<view class="page">
		<view class="header-section">
			<view class="user-wrapper">
				<view class="avatar-box">
					<text class="avatar-text">{{ initials }}</text>
				</view>
				
				<text class="user-name">{{ name }}</text>
				
				<view class="badge-row">
					<text class="tag company-tag">{{ tenant }}</text>
					<text class="tag" :class="role === 'ADMIN' ? 'role-gold' : 'role-blue'">{{ roleDisplay }}</text>
				</view>
			</view>
		</view>

		<view class="menu-container">
			
			<view v-if="role === 'ADMIN'" class="section">
				<text class="section-title white-text">ä¼ä¸šç®¡ç†</text>
				
				<view class="card-box">
					<view class="row-item border-line" @click="go('/pages/profile/company')">
						<view class="left-flex">
							<view class="icon-bg blue-bg"><text class="emoji-icon">ğŸ¢</text></view>
							<text class="item-text">å…¬å¸ä¿¡æ¯è®¾ç½®</text>
						</view>
						<text class="arrow-right">â€º</text>
					</view>
					
					<view class="row-item border-line" @click="go('/pages/profile/staff')">
						<view class="left-flex">
							<view class="icon-bg purple-bg"><text class="emoji-icon">ğŸ‘¥</text></view>
							<text class="item-text">å‘˜å·¥è´¦å·ç®¡ç†</text>
						</view>
						<text class="arrow-right">â€º</text>
					</view>
					
					<view class="row-item" @click="go('/pages/account/list')">
						<view class="left-flex">
							<view class="icon-bg green-bg"><text class="emoji-icon">ğŸ’³</text></view>
							<text class="item-text">èµ„é‡‘è´¦æˆ·ç®¡ç†</text>
						</view>
						<text class="arrow-right">â€º</text>
					</view>
				</view>
			</view>

			<view class="section">
				<text class="section-title dark-text">ä¸ªäººä¸­å¿ƒ</text>
				
				<view class="card-box">
					<view class="row-item border-line" @click="go('/pages/profile/performance')">
						<view class="left-flex">
							<view class="icon-bg cyan-bg"><text class="emoji-icon">ğŸ“Š</text></view>
							<text class="item-text">æˆ‘çš„ä¸šç»©æˆ˜æŠ¥</text>
						</view>
						<text class="arrow-right">â€º</text>
					</view>
					
					<view class="row-item" @click="go('/pages/profile/password')">
						<view class="left-flex">
							<view class="icon-bg orange-bg"><text class="emoji-icon">ğŸ”’</text></view>
							<text class="item-text">ä¿®æ”¹ç™»å½•å¯†ç </text>
						</view>
						<text class="arrow-right">â€º</text>
					</view>
				</view>
			</view>

			<button class="logout-button" @click="logout">é€€å‡ºç™»å½•</button>
			
			<view class="version-text">ZenERP v4.2</view>
		</view>
	</view>
</template>

<script>
	import { request } from '@/common/api.js';
	export default {
		data() {
			return {
				name: 'åŠ è½½ä¸­...',
				initials: 'Z',
				tenant: '',
				role: '',
				roleDisplay: ''
			}
		},
		onShow() {
			this.name = uni.getStorageSync('username') || 'ç”¨æˆ·';
			this.role = uni.getStorageSync('role') || 'SALES';
			this.tenant = uni.getStorageSync('tenant_name') || 'æœªå…¥é©»';
			
			if (this.name && this.name !== 'åŠ è½½ä¸­...') {
				this.initials = this.name.substring(0, 1).toUpperCase();
			}
			this.roleDisplay = this.role === 'ADMIN' ? 'è€æ¿' : 'å‘˜å·¥';
		},
		methods: {
			go(url) { uni.navigateTo({ url }); },
			async logout() {
				uni.showModal({
					title: 'æç¤º',
					content: 'ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ',
					success: async (res) => {
						if (res.confirm) {
							await request({ url: '/api/logout/' });
							uni.removeStorageSync('sessionid');
							uni.removeStorageSync('role');
							uni.removeStorageSync('csrftoken');
							uni.reLaunch({ url: '/pages/login/login' });
						}
					}
				})
			}
		}
	}
</script>

<style>
	.page { background-color: #f5f7fa; min-height: 100vh; }
	
	/* 1. å¤´éƒ¨åŒºåŸŸ */
	.header-section {
		background-image: linear-gradient(to bottom, #2563eb, #3b82f6);
		padding: 60rpx 40rpx 140rpx; 
		border-radius: 0 0 40rpx 40rpx;
		display: flex;
		flex-direction: column;
		align-items: center;
	}
	
	.user-wrapper {
		display: flex;
		flex-direction: column;
		align-items: center; 
		width: 100%;
	}
	
	.avatar-wrapper {
		width: 140rpx; height: 140rpx;
		background-color: rgba(255,255,255,0.2);
		border: 4rpx solid rgba(255,255,255,0.4);
		border-radius: 70rpx;
		display: flex; 
		flex-direction: row;
		align-items: center; justify-content: center;
		margin-bottom: 20rpx;
	}
	.avatar-text { font-size: 60rpx; color: #fff; font-weight: 900; }
	
	.user-name {
		font-size: 44rpx; font-weight: 900; color: #fff;
		margin-bottom: 20rpx; text-align: center;
	}
	
	.badge-row {
		display: flex; 
		flex-direction: row; 
		align-items: center; 
		justify-content: center; 
		gap: 12rpx;
	}
	.tag { padding: 8rpx 20rpx; border-radius: 10rpx; font-size: 24rpx; font-weight: bold; color: #fff; }
	.company-tag { background-color: rgba(0,0,0,0.2); }
	.role-gold { background-color: #f59e0b; }
	.role-blue { background-color: #3b82f6; }

	/* 2. èœå•å®¹å™¨ */
	.menu-container { padding: 0 30rpx; margin-top: -100rpx; }
	.section { margin-bottom: 30rpx; }
	
	.section-title { 
		font-size: 30rpx; 
		font-weight: bold; 
		margin-left: 14rpx; 
		margin-bottom: 20rpx; 
		margin-top: 20rpx; 
	}
	
	.white-text { color: #ffffff; text-shadow: 0 2rpx 4rpx rgba(0,0,0,0.1); }
	.dark-text { color: #64748b; }
	
	.card-box { background-color: #fff; border-radius: 24rpx; overflow: hidden; box-shadow: 0 4rpx 16rpx rgba(0,0,0,0.06); }
	
	/* 3. èœå•è¡Œ */
	.row-item {
		display: flex;
		flex-direction: row; 
		align-items: center;
		justify-content: space-between; 
		padding: 34rpx 30rpx;
		background-color: #fff;
	}
	.row-item:active { background-color: #f8fafc; }
	.border-line { border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #f1f5f9; }
	
	.left-flex {
		display: flex;
		flex-direction: row; 
		align-items: center;
	}
	
	.icon-bg {
		width: 64rpx; height: 64rpx; border-radius: 16rpx;
		display: flex; flex-direction: row;
		align-items: center; justify-content: center;
		margin-right: 24rpx;
	}
	.blue-bg { background-color: #eff6ff; }
	.purple-bg { background-color: #f3e8ff; }
	.green-bg { background-color: #f0fdf4; }
	.orange-bg { background-color: #fff7ed; }
	.cyan-bg { background-color: #ecfeff; }
	.emoji-icon { font-size: 32rpx; }
	
	.item-text { font-size: 30rpx; color: #1e293b; font-weight: 500; }
	
	/* ğŸŸ¢ ä¿®å¤ï¼šåŠ å¤§å­—å·ï¼Œä½¿ç”¨ Unicode ç®­å¤´ */
	.arrow-right { 
		font-size: 40rpx; color: #cbd5e1; 
		font-weight: bold; font-family: monospace; 
		line-height: 1; margin-top: -6rpx;
	}
	
	.logout-button {
		background-color: #fee2e2; color: #ef4444;
		font-weight: bold; font-size: 32rpx;
		border-radius: 20rpx;
		height: 96rpx; line-height: 96rpx;
		margin-top: 60rpx;
	}
	.version-text { text-align: center; color: #cbd5e1; font-size: 22rpx; margin-top: 40rpx; margin-bottom: 40rpx; }
</style>